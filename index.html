<!DOCTYPE html>  
<html lang="en">  
<head>  
  <meta charset="UTF-8" />  
  <meta name="viewport" content="width=device-width, initial-scale=1" />  
  <title>CricStreamZone - Live Matches & Upcoming</title>  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.7.4/lottie.min.js">  
</script>  
  <style>  
  	.menu-dropdown {  
  position: relative;  
  display: inline-block;  
}  
  
.menu-toggle {  
  background: none;  
  border: none;  
  font-size: 22px;  
  color: #fff;  
  cursor: pointer;  
  padding: 5px;  
  margin-left: 0px;  
  margin-right: 20px;
}
  
.dropdown-content {  
  display: none;  
  position: absolute;  
  right: 0;  
  top: 30px;  
  background-color: #222;  
  box-shadow: 0 4px 8px rgba(0,0,0,0.7);  
  border-radius: 8px;  
  z-index: 1001;  
  overflow: hidden;  
  min-width: 180px;  
}  
  
.dropdown-content a {  
  color: #fff;  
  padding: 10px 16px;  
  display: block;  
  text-decoration: none;  
  font-size: 14px;  
  transition: background 0.3s ease;  
}  
  
.dropdown-content a:hover {  
  background-color: #0af;  
}  
  
.menu-dropdown:hover .dropdown-content {  
  display: block;  
}  

/* Drawer (Side menu) */  
#drawer {  
  position: fixed;  
  top: 0;  
  left: -600px;  
  width: 280px;  
  height: 100%;  
  background: #111;  
  z-index: 2000;  
  padding: 20px;  
  box-shadow: 2px 0 10px rgba(0, 0, 0, 0.7);  
  transition: left 0.3s ease;  
}  
#drawer.open {  
  left: 0;  
}  
#drawer h3 {  
  color: #0af;  
  margin-bottom: 20px;  
}  
#drawer a {  
  display: block;  
  color: #fff;  
  text-decoration: none;  
  margin-bottom: 12px;  
  padding: 10px;  
  border-radius: 6px;  
  transition: background 0.2s ease;  
  font-weight: 600;  
  background: #222;  
}  
#drawer a:hover {  
  background: #0af;  
  color: #fff;  
}  
#drawerClose {  
  background: none;  
  color: #ccc;  
  border: none;  
  font-size: 22px;  
  position: absolute;  
  top: 10px;  
  right: 15px;  
  cursor: pointer;  
}  

/* Backdrop overlay */  
#drawerOverlay {  
  display: none;  
  position: fixed;  
  top: 0;  
  left: 0;  
  height: 100%;  
  width: 100%;  
  background: #00000080;  
  z-index: 1500;  
}  
#drawerOverlay.show {  
  display: block;  
}  

    body {  
      margin: 0;  
      background: #111;  
      color: #fff;  
      font-family: 'Segoe UI', sans-serif;  
    }  
    nav {  
      background: #222;  
      padding: 12px 20px;  
      display: flex;  
      align-items: center;  
      justify-content: space-between;  
    }  
    .logo {  
      font-size: 20px;  
      font-weight: bold;  
      color: #0ff;  
    }  
    
    /* Search Container - Mobile Fixed */
.search-container {  
  position: relative;
  display: flex;
  align-items: center;
}

.search-icon {
  background: none;
  border: none;
  color: #0af;
  font-size: 20px;
  cursor: pointer;
  padding: 8px;
  transition: color 0.3s ease;
  min-width: 40px;
  min-height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.search-icon:hover {
  color: #0ff;
}

.search-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  z-index: 1500;
  display: none;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.search-overlay.active {
  display: block;
  opacity: 1;
}

.search-input {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 60px;
  background: #222;
  border: none;
  outline: none;
  color: #fff;
  font-size: 16px;
  padding: 0 60px 0 20px;
  z-index: 1600;
  transform: translateY(-100%);
  transition: transform 0.3s ease;
  border-bottom: 2px solid #0af;
  box-sizing: border-box;
}

.search-input.active {
  transform: translateY(0);
}

.search-input::placeholder {
  color: #888;
}

.search-close {
  position: fixed;
  top: 15px;
  right: 20px;
  background: none;
  border: none;
  color: #0af;
  font-size: 24px;
  cursor: pointer;
  z-index: 1700;
  opacity: 0;
  transform: translateY(-100%);
  transition: all 0.3s ease;
  min-width: 30px;
  min-height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.search-close.active {
  opacity: 1;
  transform: translateY(0);
}

/* Mobile specific fixes */
@media (max-width: 768px) {
  .search-icon {
    font-size: 18px;
    padding: 10px;
  }
  
  .search-input {
    font-size: 16px;
    -webkit-appearance: none;
    -webkit-border-radius: 0;
    -webkit-user-select: text;
    user-select: text;
  }
  
  .search-input:focus {
    outline: none;
    border-bottom: 2px solid #0ff;
  }
}

/* Prevent zoom on iOS */
@media screen and (max-width: 768px) {
  .search-input {
    font-size: 16px !important;
    transform-origin: left top;
  }
}

    .notice {  
  background: #000;
  color: #fff;  
  padding: 05px 0;  
  font-weight: bold;  
  text-align: center;
  border-top: 1px solid #fff;
  border-bottom: 1px solid #fff;
  border-radius: 8px;
  margin: 0;
  width: 100%;
}

.notice marquee {
  color: #fff;
}  
  
  .server-content {
  background: #222;
  border-radius: 50px;
  padding: 16px;
  max-width: 80%;
  width: 280px;
  max-height: 80%;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.server-list {
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  width: 100%;
}

.server-item {
  color: #fff;
  padding: 10px 0;
  text-align: center;
  cursor: pointer;
  font-size: 16px;
  font-weight: normal;
  text-decoration: none;
  display: block;
  margin-bottom: 5px;
  width: 100%;
  background: none;
  border: none;
}

.server-item:hover {
  color: #0af;
}

    /* সাব-ট্যাব স্টাইল */  
    .sub-tab-btns {  
      padding: 8px;  
      text-align: center;  
      background: #222;  
    }  
    .sub-tab-btns button {  
      margin: 0 6px;  
      padding: 6px 14px;  
      border: none;  
      border-radius: 5px;  
      background: #333;  
      color: #fff;  
      cursor: pointer;  
      font-weight: 600;  
      font-size: 14px;  
      transition: background 0.3s ease;  
    }  
    .sub-tab-btns button:hover {  
      background: #0af;  
    }  
    .sub-tab-btns .active {  
      background: #0af;  
    }  
  
    /* নিচের বড় ট্যাব স্টাইল */  
    .bottom-tab-btns {  
      position: fixed;  
      bottom: 0;  
      width: 100%;  
      background: #222;  
      display: flex;  
      justify-content: space-around;  
      padding: 10px 0;  
      box-shadow: 0 -2px 8px rgba(0,0,0,0.8);  
      z-index: 1000;  
    }  
    .bottom-tab-btns button {  
      background: #333;  
      border: none;  
      color: #fff;  
      padding: 12px 20px;  
      font-size: 16px;  
      font-weight: 700;  
      border-radius: 8px;  
      cursor: pointer;  
      flex: 1;  
      margin: 0 8px;  
      transition: background 0.3s ease;  
    }  
    .bottom-tab-btns button.active {  
      background: #0af;  
      color: #fff;  
    }  
    .bottom-tab-btns button:hover:not(.active) {  
      background: #555;  
    }  
  
    #match-list {  
      padding: 10px 10px 70px; /* নিচের ট্যাব স্পেস ফাঁকা রাখলাম */  
    }  
    
    /* Match Card - SportzX Style */
    .match {  
      background: linear-gradient(135deg, #1e1e2e, #2a2a3a);
      border-radius: 12px;  
      margin-bottom: 15px;  
      box-shadow: 0 2px 5px rgba(0,0,0,0.5);  
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
      overflow: hidden;
      border: 1px solid #333;
    }  
    .match:hover {  
  transform: scale(1.02);  
}

    .match-header {
      background: #000; /* Match Title বক্স কালো */
      color: #fff; /* লেখা সাদা */
      padding: 8px 15px;
      font-size: 13px;
      font-weight: 600;
      text-align: center;
    }

    .match-content {
      padding: 15px;
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      gap: 15px;
    }

    .match-left {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    .match-time-date {
      font-size: 12px; /* Today ও Upcoming এর জন্য বড় করা হয়েছে */
      color: #fff; /* লেখা সাদা */
      margin-bottom: 5px;
      font-weight: 600;
    }

    .match-center {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .teams-vs {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .team {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 60px;
    }

    .team img {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      margin-bottom: 5px;
    }

    .team-name {
      font-size: 11px;
      font-weight: 600;
      text-align: center;
    }

    .vs-text {
      font-weight: bold;
      color: #0af;
      font-size: 12px;
      margin: 0 15px;
      background: #333;
      padding: 4px 8px;
      border-radius: 8px;
    }

    .match-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      text-align: right;
    }

    .match-status {
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .live-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .countdown-text {
      font-size: 14px; /* বড় করা হয়েছে */
      color: #fff; /* সাদা কালার */
      font-weight: 600;
    }

    /* Live Timer Style */
    .live-timer {
      font-size: 15px;
      color: #fff; /* সাদা কালার */
      font-weight: 600;
      font-family: 'Courier New', monospace;
    }

    /* Day Name Style for Upcoming */
    .day-name {
      font-size: 14px; /* বড় করা হয়েছে */
      color: #fff; /* সাদা কালার */
      font-weight: 700;
    }

    .liveBlink {  
      display: inline-block;  
      padding: 4px 8px;  
      font-weight: 900;  
      font-size: 9px;  
      color: white;  
      background: linear-gradient(45deg, #ff003c, #ff7700, #ff003c);  
      background-size: 200% 200%;  
      border-radius: 15px;  
      animation: gradientPulse 3s ease infinite, blinkOpacity 1.5s infinite;  
      box-shadow: 0 0 8px #ff003c;  
      user-select: none;  
      text-transform: uppercase;  
    }  
    @keyframes blinkOpacity {  
      0%, 100% { opacity: 1; }  
      50% { opacity: 0.3; }  
    }  
    @keyframes gradientPulse {  
      0% { background-position: 0% 50%; }  
      50% { background-position: 100% 50%; }  
      100% { background-position: 0% 50%; }  
    }

    /* Server List Modal */
    .server-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  z-index: 2000;
  display: none;
  align-items: center;
  justify-content: center;
}

    .server-modal.active {
      display: flex;
    }

    .server-content {
  background: #222;
  border-radius: 6px;
  padding: 12px;
  max-width: 80%;
  width: 280px;
  max-height: 65%;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  align-items: center;
}

    .server-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #333;
    }

    .server-title {
      color: #0af;
      font-size: 18px;
      font-weight: 600;
    }

    .server-close {
      background: none;
      border: none;
      color: #ccc;
      font-size: 24px;
      cursor: pointer;
    }

    .server-list {
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  justify-content: center;
  height: 100%;
  width: 100%;
}

    .server-item {
      background: #333;
      border: none;
      color: #fff;
      padding: 15px;
      border-radius: 8px;
      text-align: left;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: background 0.3s ease;
      text-decoration: none;
      display: block;
    }

    .server-item:hover {
      background: #0af;
      color: #000;
    }
  
    /* TV & FM আলাদা সেকশন */  
    #tv-section, #fm-section {  
      padding: 10px;  
      font-size: 16px;  
      color: #ccc;  
      text-align: center;  
    }  
  </style>  
</head>  
<body>  

<!-- Drawer / Side Menu -->  
<div id="drawer">  
  <button id="drawerClose" onclick="toggleDrawer()">✕</button>  
  
  <!-- Logo Section with Image -->
<div style="text-align: center; margin-bottom: 25px; padding-bottom: 20px; border-bottom: 1px solid #333;">
  <img src="https://i.postimg.cc/3rPWWckN/icon-192.png" alt="CricStreamZone Logo" style="width: 80px; height: 80px; border-radius: 50%; margin-bottom: 10px; border: 3px solid #0af;" />
    <div style="color: #888; font-size: 12px;">All Sports Live Streaming</div>
</div>
  
  <h3></h3>  
  <a href="https://t.me/CricStreamZone" target="_blank">📣 Join Telegram</a>  
  <a href="https://play.google.com/store/apps/details?id=com.genuine.leone" target="_blank">📲 Download NS Player</a>  
  <a href="#" onclick="showCategory('live'); toggleDrawer();">🏏 Live Matches</a>  
  <a href="#" onclick="showCategory('tv'); toggleDrawer();">📺 Live TV</a>  
  <a href="#" onclick="showCategory('fm'); toggleDrawer();">📻 FM Radio</a>  
</div>  
<div id="drawerOverlay" onclick="toggleDrawer()"></div>

<nav>  
  <div style="display: flex; align-items: center;">
    <button onclick="toggleDrawer()" class="menu-toggle">☰</button>
    <div class="logo">CricStreamZone</div>
  </div>
  <div class="search-container">  
  <button class="search-icon" onclick="toggleSearch()">🔍</button>
</div>

<!-- Search Overlay and Input (body এর শেষে যোগ করুন) -->
<div id="searchOverlay" class="search-overlay" onclick="closeSearch()"></div>
<input id="search" class="search-input" type="text" placeholder="Search matches, teams..." autocomplete="off" />
<button class="search-close" onclick="closeSearch()">✕</button>
  </div>
</nav>  
  
<div class="notice">  
  <marquee scrollamount="3">Welcome to CricStreamZone! ⚠️ Install NS Player for smooth streaming 📲 Join our Telegram for updates!</marquee>  
</div>  
  
<!-- সাব-ট্যাব শুধুমাত্র Live Category তে দেখাবে -->  
<div id="subTabs" class="sub-tab-btns" style="display:none;">  
  <button id="subLive" class="active">Live <span id="countLive"></span></button>  
  <button id="subToday">Today <span id="countToday"></span></button>  
  <button id="subUpcoming">Upcoming <span id="countUpcoming"></span></button>  
</div>  
  
<div id="match-list"></div>  
  
<!-- TV এবং FM সেকশন -->  
<div id="tv-section" style="display:none;">  
  <h2>Live TV Channels</h2>  
  <p>TV Channel 1 - Link, TV Channel 2 - Link ... (এখানে TV এর লিংক দেখাবে)</p>  
</div>  
  
<div id="fm-section" style="display:none;">  
  <h2>FM Radio Stations</h2>  
  <p>FM Station 1 - Link, FM Station 2 - Link ... (এখানে FM এর লিংক দেখাবে)</p>  
</div>  

<!-- Server Modal -->
<div id="serverModal" class="server-modal" onclick="closeServerModal()">
  <div class="server-content" onclick="event.stopPropagation();"> <!-- Prevent click from closing modal -->
    <div id="serverList" class="server-list" style="text-align: center;"> <!-- Center the text -->
      <div style="color: #fff; margin-bottom: 22px;">Multiple Links Available</div>
      <!-- Server links will be populated here -->
    </div>
  </div>
</div>
  
<!-- নিচের বড় ৩টা ট্যাব -->  
<div class="bottom-tab-btns">  
  <button id="bottomLive" class="active">  
    <img src="https://i.postimg.cc/BvWg87Rd/videocam-24dp-E3-E3-E3-FILL0-wght400-GRAD0-opsz24.png" alt="Live Icon" style="vertical-align: middle; margin-right: 6px;" />  
    Live  
  </button>  
    <button id="bottomTV">  
    <img src="https://i.postimg.cc/K8JDvvxs/live-tv-24dp-E3-E3-E3-FILL0-wght400-GRAD0-opsz24.png" alt="TV Icon" style="vertical-align: middle; margin-right: 6px;" />  
    TV  
  </button>  
  <button id="bottomFM">  
    <img src="https://i.postimg.cc/YC472jwd/radio-24dp-E3-E3-E3-FILL0-wght400-GRAD0-opsz24.png" alt="FM Icon" style="vertical-align: middle; margin-right: 6px;" />  
    FM  
  </button>  
</div>  

<!-- Telegram Join Popup -->  
<div id="telegramPopup" style="display:none;">  
  <div style="position:fixed; top:0; left:0; width:100%; height:100%; background:#000000aa; z-index:9999; display:flex; align-items:center; justify-content:center;">  
    <div style="background:#222; padding:20px 25px; border-radius:12px; max-width:90%; width:340px; text-align:center; box-shadow:0 0 10px #000;">  
      <h3 style="color:#0af; margin-bottom:10px;">📣 Join Our Telegram</h3>  
      <p style="color:#ccc; font-size:14px;">🔔 For live match updates, instant scores, and exclusive stream links —  
Join our official Telegram channel now!  
📲 Download the NS Player app for smooth, uninterrupted streaming.</p>  
      <div style="margin-top:15px;">  
        <a href="https://t.me/CricStreamZone" target="_blank" style="background:#08f; color:#fff; padding:10px 18px; text-decoration:none; border-radius:8px; display:inline-block; font-weight:600;">Join Now</a>  
        <button onclick="closeTelegramPopup()" style="margin-left:10px; background:#444; color:#ccc; padding:10px 18px; border:none; border-radius:8px; cursor:pointer;">Later</button>  
      </div>  
    </div>  
  </div>  
</div>

<script>  
// Search functionality - Updated
function toggleSearch() {
  const searchInput = document.getElementById('search');
  const searchClose = document.querySelector('.search-close');
  const searchOverlay = document.getElementById('searchOverlay');
  
  if (!searchInput.classList.contains('active')) {
    // Open search
    searchOverlay.classList.add('active');
    searchInput.classList.add('active');
    searchClose.classList.add('active');
    
    // Focus after animation
    setTimeout(() => {
      searchInput.focus();
      // For mobile devices
      if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        searchInput.click();
      }
    }, 350);
  } else {
    closeSearch();
  }
}

function closeSearch() {
  const searchInput = document.getElementById('search');
  const searchClose = document.querySelector('.search-close');
  const searchOverlay = document.getElementById('searchOverlay');
  
  searchOverlay.classList.remove('active');
  searchInput.classList.remove('active');
  searchClose.classList.remove('active');
  searchInput.value = '';
  searchInput.blur();
  
  // Re-render matches if in live category
  if(document.getElementById('subTabs').style.display === 'block'){  
    renderMatches(currentSubTab);  
  }
}

// Add escape key handler
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape' && document.getElementById('search').classList.contains('active')) {
    closeSearch();
  }
});

// Prevent body scroll when search is open
document.getElementById('search').addEventListener('focus', function() {
  document.body.style.overflow = 'hidden';
});

// Search input event listener (existing code এর জায়গায়)
document.getElementById('search').addEventListener('input', (e) => {  
  if(document.getElementById('subTabs').style.display === 'block'){  
    renderMatches(currentSubTab);  
  }
});

// Add search on enter key
document.getElementById('search').addEventListener('keydown', function(e) {
  if (e.key === 'Enter') {
    e.preventDefault();
    this.blur(); // Hide keyboard on mobile
  }
});

  // Drawer toggle function
  function toggleDrawer() {  
    const drawer = document.getElementById('drawer');  
    const overlay = document.getElementById('drawerOverlay');  
    drawer.classList.toggle('open');  
    overlay.classList.toggle('show');  
  }

  // Server modal functions
  function openServerModal(servers) {
  const modal = document.getElementById('serverModal');
  const serverList = document.getElementById('serverList');
  
  serverList.innerHTML = '<div style="color: #fff; text-align: center; margin-bottom: 22px;">Multiple Links Available</div>'; // Add the title
  
  if (servers && servers.length > 0) {
    servers.forEach(server => {
      const serverItem = document.createElement('a');
serverItem.href = server.link;
serverItem.target = '_blank';
serverItem.rel = 'noopener noreferrer';
serverItem.textContent = server.name;
serverItem.style.cssText = `
  color: #fff;
  padding: 10px 0;
  text-align: center;
  cursor: pointer;
  font-size: 16px;
  font-weight: normal;
  text-decoration: none;
  display: block;
  margin-bottom: 5px;
`;
serverItem.onmouseover = () => serverItem.style.color = '#0af';
serverItem.onmouseout = () => serverItem.style.color = '#fff';
serverList.appendChild(serverItem);
    });
  } else {
    serverList.innerHTML += '<div style="color:#888; text-align:center; padding:20px;">No servers available</div>';
  }
  
  modal.classList.add('active');
}

  // Telegram popup functions
  function closeTelegramPopup() {  
    document.getElementById('telegramPopup').style.display = 'none';  
    localStorage.setItem('hideTelegramPopup', 'true');  
  }  
  
  window.addEventListener('load', () => {  
    const alreadyClosed = localStorage.getItem('hideTelegramPopup');  
    if (!alreadyClosed) {  
      setTimeout(() => {  
        document.getElementById('telegramPopup').style.display = 'block';  
      }, 5000); // ৫ সেকেন্ড পরে দেখাবে  
    }  
  });

  // API url (আপনার গুগল অ্যাপস স্ক্রিপ্ট / API url দিন এখানে)  
  const matchesApi = "https://script.google.com/macros/s/AKfycbxzx4xcwEGidoxEd7BQshkR9FKHjK5o0p8ukNY4NsKNR0EsShY7eV3MUxA2iXz1V8bmHg/exec";  
  
  let matches = [];  
  let intervals = [];  
  let currentSubTab = 'live'; // Live Category এর জন্য সাব-ট্যাব  
  
  function clearIntervals() {  
    intervals.forEach(i => clearInterval(i));  
    intervals = [];  
  }  
  
  function getNow() { return new Date(); }  
  function getCountdown(t) { return Math.max(0, new Date(t) - getNow()); }  
  
  // নতুন ফরম্যাট ফাংশন - ঘন্টা:মিনিট:সেকেন্ড
  function formatTime(ms) {
    let s = Math.floor(ms / 1000);
    let m = Math.floor(s / 60);
    let h = Math.floor(m / 60);
    
    h = h % 24;
    m = m % 60;
    s = s % 60;
    
    return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
  }
  
  function formatCountdown(ms) {
  return formatTime(ms); // 'Left' শব্দটি রিমুভ করা হয়েছে
}
  
  function formatCountUp(ms) {
    return formatTime(ms);
  }
  
  // দিনের নাম বের করার ফাংশন
  function getDayName(date) {
    const today = new Date();
    const tomorrow = new Date(today);
    tomorrow.setDate(today.getDate() + 1);
    
    const targetDate = new Date(date);
    
    if (targetDate.toDateString() === tomorrow.toDateString()) {
      return 'Tomorrow';
    }
    
    const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    return days[targetDate.getDay()];
  }
  
  function renderMatches(type = 'live') {  
  clearIntervals();  
  const now = getNow();  
  const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());  
  const todayEnd = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);  
  
  const list = document.getElementById('match-list');  
  list.innerHTML = "";  
  const filter = document.getElementById('search').value.toLowerCase();  
  
  let filteredMatches = matches.filter(m => {  
  const ct = new Date(m.MatchTime);  
  const oneHourBefore = new Date(ct.getTime() - 60 * 60 * 1000); // Changed to 1 hour
  const isLive = now >= ct;
  const isComingSoon = now >= oneHourBefore && now < ct;
  
  if (type === 'live' && !(isLive || isComingSoon)) return false;  
  
  else if (type === 'today') {  
    if (ct < todayStart || ct >= todayEnd || isLive || isComingSoon) return false;  
  }  
  
  else if (type === 'upcoming') {  
    if (ct < now || (ct >= todayStart && ct < todayEnd) || isComingSoon) return false;  
  }  
  
  if (filter && !(m.Match.toLowerCase().includes(filter) || m.Team1.toLowerCase().includes(filter) || m.Team2.toLowerCase().includes(filter))) return false;  
  
  return true;});  
  
// 🔀 এইখানে টাইম অনুযায়ী ছোট থেকে বড় সাজানো হচ্ছে  
filteredMatches.sort((a, b) => new Date(a.MatchTime) - new Date(b.MatchTime));  
  
  if (filteredMatches.length === 0) {  
  let emojiMessage = '😴 No matches available right now.';  
  if (type === 'live') emojiMessage = '📴 No live matches at the moment.';  
  else if (type === 'upcoming') emojiMessage ='🕒 No upcoming matches found.';  
  else if (type === 'today') emojiMessage = '📅 No matches scheduled for today.';  
  
  list.innerHTML = `  
    <div style="  
      max-width: 420px;  
      margin: 40px auto;  
      padding: 30px 20px;  
      background: #1e1e1e;  
      border-radius: 14px;  
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.12);  
      color: #ccc;  
      font-family: 'Segoe UI', sans-serif;  
      font-size: 1.25rem;  
      font-weight: 500;  
      text-align: center;  
      user-select: none;  
      display: flex;  
      align-items: center;  
      justify-content: center;  
      gap: 14px;  
    ">  
      <span style="font-size: 2.5rem;">${emojiMessage.match(/^(\p{Emoji_Presentation}|\p{Extended_Pictographic})+/u)[0]}</span>  
      <span>${emojiMessage.replace(/^(\p{Emoji_Presentation}|\p{Extended_Pictographic})+\s*/, '')}</span>  
    </div>  
  `;  
  return;  
}  
  
  filteredMatches.forEach((m, i) => {  
  const ct = new Date(m.MatchTime);  
  const oneHourBefore = new Date(ct.getTime() - 60 * 60 * 1000); // Changed to 1 hour
  const isLive = now >= ct;
  const isComingSoon = now >= oneHourBefore && now < ct;
  
  const div = document.createElement('div');  
  div.className = "match";
  
  // Click handler for opening server modal
  div.onclick = () => {
  if (m.servers && m.servers.length > 0) {
    openServerModal(m.servers); // Call without title
  }
};
  
  const dateStr = ct.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });  
  const timeStr = ct.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
  
  let statusContent = '';
  let leftContent = '';
  
  if (isLive) {
    // Live Tab - বাম পাশে টাইমার, ডান পাশে এনিমেশন
    leftContent = `
      <div class="live-timer" id="cd${type}${i}"></div>
    `;
    statusContent = `
      <div class="live-indicator">
        <div id="liveAnim${i}" style="width: 60px; height: 60px;"></div>
      </div>
    `;
  } else if (isComingSoon && type === 'live') {
    // Coming Soon - 1 hour before match in Live tab
    leftContent = `
      <div class="live-timer" id="cd${type}${i}"></div>
    `;
    statusContent = `
      <div id="comingSoonAnim${i}" style="width: 60px; height: 60px;"></div>
    `;
  } else if (type === 'today') {
    // Today Tab - বাম পাশে একসাথে টাইম ডেট, ডান পাশে কাউন্টডাউন
    leftContent = `
      <div class="match-time-date">${dateStr} ${timeStr}</div>
    `;
    statusContent = `
      <div class="countdown-text" id="cd${type}${i}"></div>
    `;
  } else if (type === 'upcoming') {
    // Upcoming Tab - বাম পাশে একসাথে টাইম ডেট, ডান পাশে দিনের নাম
    leftContent = `
      <div class="match-time-date">${dateStr} ${timeStr}</div>
    `;
    const dayName = getDayName(m.MatchTime);
    statusContent = `
      <div class="day-name">${dayName}</div>
    `;
  }  
  
  div.innerHTML = `
    <div class="match-header">
      ${m.Match}
    </div>
    <div class="match-content">
      <div class="match-left">
        ${leftContent}
      </div>
      
      <div class="match-center">
        <div class="teams-vs">
          <div class="team">
            <img src="${m.Team1Logo}" alt="${m.Team1}" loading="lazy" />
            <div class="team-name">${m.Team1}</div>
          </div>
          <div class="vs-text">VS</div>
          <div class="team">
            <img src="${m.Team2Logo}" alt="${m.Team2}" loading="lazy" />
            <div class="team-name">${m.Team2}</div>
          </div>
        </div>
      </div>
      
      <div class="match-right">
        ${statusContent}
      </div>
    </div>
  `;
  
  list.appendChild(div);  
  
  // ⬇️ এইখানে Lottie animation শুরু হবে live এর জন্য  
if (isLive) {  
  setTimeout(() => {  
    const animContainer = document.getElementById('liveAnim' + i);
    if (animContainer && !animContainer.hasAttribute('data-loaded')) {
      animContainer.setAttribute('data-loaded', 'true');
      bodymovin.loadAnimation({  
        container: animContainer,  
        renderer: 'svg',  
        loop: true,  
        autoplay: true,  
        path: 'https://raw.githubusercontent.com/Hasanmahmud000/HasanTv/refs/heads/main/live-icon.json'  
      });  
    }
  }, 0);  
}  

// ⬇️ এইখানে Coming Soon animation যোগ করুন
if (isComingSoon && type === 'live') {  
  setTimeout(() => {  
    const animContainer = document.getElementById('comingSoonAnim' + i);
    if (animContainer && !animContainer.hasAttribute('data-loaded')) {
      animContainer.setAttribute('data-loaded', 'true');
      bodymovin.loadAnimation({  
        container: animContainer,  
        renderer: 'svg',  
        loop: true,  
        autoplay: true,  
        path: 'https://raw.githubusercontent.com/Hasanmahmud000/Ccvv/refs/heads/main/live-icon.json'  
      });  
    }
  }, 0);  
}
  
    // Timer intervals - Updated with Coming Soon to Live transition
    if (isLive || isComingSoon) {  
      intervals.push(setInterval(() => {  
        const now = getNow();
        const matchTime = new Date(m.MatchTime);
        const cdEl = div.querySelector(`#cd${type}${i}`);  
        
        if (cdEl) {  
          const diffLive = now - matchTime;  
          cdEl.innerText = formatCountUp(Math.abs(diffLive));  
        }
        
        // Check if match just became live
        if (now >= matchTime) {
          const comingSoonContainer = div.querySelector(`#comingSoonAnim${i}`);
          
          if (comingSoonContainer) {
            // Clear coming soon animation
            comingSoonContainer.innerHTML = '';
            
            // Change ID to live animation
            comingSoonContainer.id = `liveAnim${i}`;
            
            // Load live animation
            bodymovin.loadAnimation({  
              container: comingSoonContainer,  
              renderer: 'svg',  
              loop: true,  
              autoplay: true,  
              path: 'https://raw.githubusercontent.com/Hasanmahmud000/HasanTv/refs/heads/main/live-icon.json'  
            });
            
            // Optional: Add a smooth transition effect
            comingSoonContainer.style.transition = 'all 0.5s ease';
            comingSoonContainer.style.transform = 'scale(1.1)';
            setTimeout(() => {
              comingSoonContainer.style.transform = 'scale(1)';
            }, 500);
          }
        }
      }, 1000));  
    } else if (type === 'today') {  
      intervals.push(setInterval(() => {  
        const cdEl = div.querySelector(`#cd${type}${i}`);  
        if (cdEl) {  
          const remain = getCountdown(m.MatchTime);  
          cdEl.innerText = remain > 0 ? formatCountdown(remain) : "Starting soon";  
        }  
      }, 1000));  
    }
  });  
}  
  
  // নিচের বড় ট্যাব হ্যান্ডলার  
  function showCategory(category) {  
    // প্রথমে সব ট্যাব হালকা করে দেব  
    document.getElementById('bottomLive').classList.remove('active');  
    document.getElementById('bottomTV').classList.remove('active');  
    document.getElementById('bottomFM').classList.remove('active');  
  
    // তারপর সিলেক্টেড ট্যাবে active যোগ করব  
    document.getElementById('bottom' + category.charAt(0).toUpperCase() + category.slice(1)).classList.add('active');  
  
    // সার্চ ইনপুট ফাঁকা করব  
    document.getElementById('search').value = '';
    // Close search if open
    document.getElementById('search').classList.remove('active');
    document.querySelector('.search-close').classList.remove('active');
  
    // সব সেকশন লুকিয়ে দিব  
    document.getElementById('subTabs').style.display = 'none';  
    document.getElementById('match-list').style.display = 'none';  
    document.getElementById('tv-section').style.display = 'none';  
    document.getElementById('fm-section').style.display = 'none';  
  
    if(category === 'live') {  
      // Live Category এ উপরের সাব-ট্যাব দেখাবো  
      document.getElementById('subTabs').style.display = 'block';  
      document.getElementById('match-list').style.display = 'block';  
      // প্রথমে সাব-ট্যাবে active সেট করে রেন্ডার করবো  
      currentSubTab = 'live';  
      setActiveSubTab(currentSubTab);  
      renderMatches(currentSubTab);  
    } else if(category === 'tv') {  
      document.getElementById('tv-section').style.display = 'block';  
    } else if(category === 'fm') {  
      document.getElementById('fm-section').style.display = 'block';  
    }  
  }  
  
  // সাব-ট্যাব হ্যান্ডলার  
  function setActiveSubTab(subTab) {  
  document.getElementById('subLive').classList.remove('active');  
  document.getElementById('subToday').classList.remove('active');   // নতুন Today এর জন্য  
  document.getElementById('subUpcoming').classList.remove('active');  
  
  document.getElementById('sub' + subTab.charAt(0).toUpperCase() + subTab.slice(1)).classList.add('active');  
}  
  
    document.getElementById('bottomLive').addEventListener('click', () => showCategory('live'));  
  document.getElementById('bottomTV').addEventListener('click', () => showCategory('tv'));  
  document.getElementById('bottomFM').addEventListener('click', () => showCategory('fm'));  
  
  // Sub Tab buttons click  
document.getElementById('subLive').addEventListener('click', () => {  
  currentSubTab = 'live';  
  setActiveSubTab(currentSubTab);  
  renderMatches(currentSubTab);  
});  
  
document.getElementById('subUpcoming').addEventListener('click', () => {  
  currentSubTab = 'upcoming';  
  setActiveSubTab(currentSubTab);  
  renderMatches(currentSubTab);  
});  
  
// ✅ এই লাইনটা নিচে বসাও  
document.getElementById('subToday').addEventListener('click', () => {  
  currentSubTab = 'today';  
  setActiveSubTab(currentSubTab);  
  renderMatches(currentSubTab);  
});  
  
  document.getElementById('search').addEventListener('input', () => {  
    if(document.getElementById('subTabs').style.display === 'block'){  
      renderMatches(currentSubTab);  
    }  
  });  
  
  // প্রথমে ডাটা লোড করে Live Category দেখাবে  
fetch(matchesApi)  
.then(res => res.json())  
.then(data => {  
  matches = data.matches || [];  

  const now = new Date();  
  const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());  
  const todayEnd = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);  

  // 🔹 সংখ্যাগুলো বের করো  
  const liveCount = matches.filter(m => {
    const ct = new Date(m.MatchTime);
    const oneHourBefore = new Date(ct.getTime() - 60 * 60 * 1000); // Changed to 1 hour
    return now >= ct || (now >= oneHourBefore && now < ct);
  }).length;

  const todayCount = matches.filter(m => {  
    const ct = new Date(m.MatchTime);
    const oneHourBefore = new Date(ct.getTime() - 60 * 60 * 1000); // Changed to 1 hour
    const isComingSoon = now >= oneHourBefore && now < ct;
    return ct >= todayStart && ct < todayEnd && ct > now && !isComingSoon;  
  }).length;

  const upcomingCount = matches.filter(m => {
    const ct = new Date(m.MatchTime);
    const oneHourBefore = new Date(ct.getTime() - 60 * 60 * 1000); // Changed to 1 hour
    const isComingSoon = now >= oneHourBefore && now < ct;
    return ct > todayEnd && !isComingSoon;
  }).length;

  // 🔹 UI তে সংখ্যা বসাও  
  document.getElementById("countLive").innerText = `(${liveCount})`;  
  document.getElementById("countToday").innerText = `(${todayCount})`;  
  document.getElementById("countUpcoming").innerText = `(${upcomingCount})`;  

  // 🔹 ম্যাচগুলোকে ফিল্টার করে সাজাও  
  const todayMatches = matches.filter(m => {  
    const ct = new Date(m.MatchTime);
    const oneHourBefore = new Date(ct.getTime() - 60 * 60 * 1000); // Changed to 1 hour
    const isComingSoon = now >= oneHourBefore && now < ct;
    return ct >= todayStart && ct < todayEnd && ct > now && !isComingSoon;  
  });  

  const upcomingMatches = matches.filter(m => {  
    const ct = new Date(m.MatchTime);
    const oneHourBefore = new Date(ct.getTime() - 60 * 60 * 1000); // Changed to 1 hour
    const isComingSoon = now >= oneHourBefore && now < ct;
    return ct > todayEnd && !isComingSoon;  
  });  

  const liveMatches = matches.filter(m => {
    const ct = new Date(m.MatchTime);
    const oneHourBefore = new Date(ct.getTime() - 60 * 60 * 1000); // Changed to 1 hour
    return now >= ct || (now >= oneHourBefore && now < ct);
  });

  matches = [  
    ...liveMatches.map(m => ({ ...m, isLive: true })),  
    ...todayMatches.map(m => ({ ...m, isToday: true })),  
    ...upcomingMatches.map(m => ({ ...m, isUpcoming: true })),  
  ];  

  // 🔥 স্মার্ট ট্যাব সিলেকশন: লাইভ না থাকলে Today দেখাবে
  if (liveCount > 0) {
    // লাইভ ম্যাচ আছে, Live ট্যাব দেখাও
    showCategory('live');
    currentSubTab = 'live';
    setActiveSubTab('live');
  } else if (todayCount > 0) {
    // লাইভ নেই কিন্তু Today আছে, Today ট্যাব দেখাও
    showCategory('live');
    currentSubTab = 'today';
    setActiveSubTab('today');
  } else {
    // কিছুই নেই, Upcoming দেখাও
    showCategory('live');
    currentSubTab = 'upcoming';
    setActiveSubTab('upcoming');
  }
  
  // সিলেক্টেড ট্যাব অনুযায়ী রেন্ডার করো
  renderMatches(currentSubTab);
})  
    .catch(e => {  
      console.error('Error fetching matches:', e);  
      document.getElementById('match-list').innerHTML = '<p style="text-align:center; color:#f00;">Failed to load match data.</p>';  
    });

  // Service Worker for PWA
  if ('serviceWorker' in navigator) {  
    navigator.serviceWorker.register('sw.js').then(registration => {  
  
      function showUpdatePopup() {  
        const box = document.createElement('div');  
        box.innerHTML = "🆕 New version available — <b>Tap to update</b>";  
        box.style.cssText = `  
          position: fixed;  
          bottom: 20px;  
          left: 50%;  
          transform: translateX(-50%);  
          background: #0af;  
          color: white;  
          padding: 12px 16px;  
          border-radius: 30px;  
          font-weight: bold;  
          box-shadow: 0 4px 8px rgba(0,0,0,0.3);  
          z-index: 9999;  
          cursor: pointer;  
        `;  
        box.onclick = () => {  
          box.remove();  
          if (registration.waiting) {  
            registration.waiting.postMessage({ action: "skipWaiting" });  
          }  
        };  
        document.body.appendChild(box);  
      }  
  
      function listenForWaitingSW(reg) {  
        if (!reg) return;  
        if (reg.waiting) return showUpdatePopup();  
  
        if (reg.installing) {  
          reg.installing.addEventListener("statechange", function () {  
            if (this.state === "installed" && navigator.serviceWorker.controller) {  
              showUpdatePopup();  
            }  
          });  
        }  
  
        reg.addEventListener("updatefound", () => {  
          if (reg.installing) {  
            reg.installing.addEventListener("statechange", function () {  
              if (this.state === "installed" && navigator.serviceWorker.controller) {  
                showUpdatePopup();  
              }  
            });  
          }  
        });  
      }  
  
      listenForWaitingSW(registration);  
    });  
  
        navigator.serviceWorker.addEventListener("controllerchange", () => {  
      window.location.reload();  
    });  
  }  

  // Touch/Swipe functionality for sub-tabs
  let touchStartX = 0;
  let touchEndX = 0;
  let touchStartY = 0;
  let touchEndY = 0;

  function handleSwipe() {
    const deltaX = touchEndX - touchStartX;
    const deltaY = touchEndY - touchStartY;
    
    // Check if horizontal swipe is more significant than vertical
    if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 50) {
      // Only work when sub-tabs are visible (Live category)
      if (document.getElementById('subTabs').style.display === 'block') {
        const subTabs = ['live', 'today', 'upcoming'];
        const currentIndex = subTabs.indexOf(currentSubTab);
        
        if (deltaX > 0) {
          // Swipe right - go to previous tab
          if (currentIndex > 0) {
            const newTab = subTabs[currentIndex - 1];
            currentSubTab = newTab;
            setActiveSubTab(currentSubTab);
            renderMatches(currentSubTab);
          }
        } else {
          // Swipe left - go to next tab
          if (currentIndex < subTabs.length - 1) {
            const newTab = subTabs[currentIndex + 1];
            currentSubTab = newTab;
            setActiveSubTab(currentSubTab);
            renderMatches(currentSubTab);
          }
        }
      }
    }
  }

  // Touch event listeners
  document.addEventListener('touchstart', function(e) {
    touchStartX = e.changedTouches[0].screenX;
    touchStartY = e.changedTouches[0].screenY;
  }, { passive: true });

  document.addEventListener('touchend', function(e) {
    touchEndX = e.changedTouches[0].screenX;
    touchEndY = e.changedTouches[0].screenY;
    handleSwipe();
  }, { passive: true });

  // Mouse event listeners for desktop
  let mouseStartX = 0;
  let mouseStartY = 0;
  let isMouseDown = false;

  document.addEventListener('mousedown', function(e) {
    mouseStartX = e.clientX;
    mouseStartY = e.clientY;
    isMouseDown = true;
  });

  document.addEventListener('mouseup', function(e) {
    if (isMouseDown) {
      const deltaX = e.clientX - mouseStartX;
      const deltaY = e.clientY - mouseStartY;
      
      if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 50) {
        if (document.getElementById('subTabs').style.display === 'block') {
          const subTabs = ['live', 'today', 'upcoming'];
          const currentIndex = subTabs.indexOf(currentSubTab);
          
          if (deltaX > 0) {
            if (currentIndex > 0) {
              const newTab = subTabs[currentIndex - 1];
              currentSubTab = newTab;
              setActiveSubTab(currentSubTab);
              renderMatches(currentSubTab);
            }
          } else {
            if (currentIndex < subTabs.length - 1) {
              const newTab = subTabs[currentIndex + 1];
              currentSubTab = newTab;
              setActiveSubTab(currentSubTab);
              renderMatches(currentSubTab);
            }
          }
        }
      }
      isMouseDown = false;
    }
  });

  document.addEventListener('mouseleave', function() {
    isMouseDown = false;
  });

  // Keyboard shortcuts
  document.addEventListener('keydown', function(e) {
    // Only work when search is not focused
    if (document.activeElement !== document.getElementById('search')) {
      if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
        if (document.getElementById('subTabs').style.display === 'block') {
          const subTabs = ['live', 'today', 'upcoming'];
          const currentIndex = subTabs.indexOf(currentSubTab);
          
          if (e.key === 'ArrowLeft' && currentIndex > 0) {
            const newTab = subTabs[currentIndex - 1];
            currentSubTab = newTab;
            setActiveSubTab(currentSubTab);
            renderMatches(currentSubTab);
          } else if (e.key === 'ArrowRight' && currentIndex < subTabs.length - 1) {
            const newTab = subTabs[currentIndex + 1];
            currentSubTab = newTab;
            setActiveSubTab(currentSubTab);
            renderMatches(currentSubTab);
          }
        }
      }
      
      // Search shortcut
      if (e.key === '/' || (e.ctrlKey && e.key === 'f')) {
        e.preventDefault();
        toggleSearch();
      }
      
      // Escape to close search or modal
      if (e.key === 'Escape') {
        if (document.getElementById('search').classList.contains('active')) {
          toggleSearch();
        } else if (document.getElementById('serverModal').classList.contains('active')) {
          closeServerModal();
        }
      }
    }
  });

  // Auto-refresh matches every 30 seconds
  setInterval(() => {
    if (document.getElementById('subTabs').style.display === 'block') {
      fetch(matchesApi)
        .then(res => res.json())
        .then(data => {
          const oldMatchesLength = matches.length;
          matches = data.matches || [];
          
          // Only re-render if there are changes
          if (matches.length !== oldMatchesLength) {
            const now = new Date();
            const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const todayEnd = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
            
            const liveCount = matches.filter(m => {
              const ct = new Date(m.MatchTime);
              const oneHourBefore = new Date(ct.getTime() - 60 * 60 * 1000); // Changed to 1 hour
              return now >= ct || (now >= oneHourBefore && now < ct);
            }).length;

            const todayCount = matches.filter(m => {
              const ct = new Date(m.MatchTime);
              const oneHourBefore = new Date(ct.getTime() - 60 * 60 * 1000); // Changed to 1 hour
              const isComingSoon = now >= oneHourBefore && now < ct;
              return ct >= todayStart && ct < todayEnd && ct > now && !isComingSoon;
            }).length;

            const upcomingCount = matches.filter(m => {
              const ct = new Date(m.MatchTime);
              const oneHourBefore = new Date(ct.getTime() - 60 * 60 * 1000); // Changed to 1 hour
              const isComingSoon = now >= oneHourBefore && now < ct;
              return ct > todayEnd && !isComingSoon;
            }).length;
            
            document.getElementById("countLive").innerText = `(${liveCount})`;
            document.getElementById("countToday").innerText = `(${todayCount})`;
            document.getElementById("countUpcoming").innerText = `(${upcomingCount})`;
            
            renderMatches(currentSubTab);
          }
        })
        .catch(e => console.error('Auto-refresh error:', e));
    }
  }, 30000); // 30 seconds

  // Prevent context menu on match cards (optional)
  document.addEventListener('contextmenu', function(e) {
    if (e.target.closest('.match')) {
      e.preventDefault();
    }
  });

  // Add loading animation
  function showLoading() {
    document.getElementById('match-list').innerHTML = `
      <div style="
        display: flex;
        justify-content: center;
        align-items: center;
        height: 200px;
        flex-direction: column;
        gap: 15px;
      ">
        <div style="
          width: 40px;
          height: 40px;
          border: 4px solid #333;
          border-top: 4px solid #0af;
          border-radius: 50%;
          animation: spin 1s linear infinite;
        "></div>
        <div style="color: #ccc; font-size: 14px;">Loading matches...</div>
      </div>
      <style>
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      </style>
    `;
  }

  // Show loading initially
  showLoading();

  // Add smooth scroll behavior
  document.documentElement.style.scrollBehavior = 'smooth';

  // Add pull-to-refresh functionality (mobile)
  let startY = 0;
  let currentY = 0;
  let pullDistance = 0;
  let isPulling = false;
  let refreshThreshold = 80;

  document.addEventListener('touchstart', function(e) {
    if (window.scrollY === 0) {
      startY = e.touches[0].clientY;
      isPulling = true;
    }
  }, { passive: true });

  document.addEventListener('touchmove', function(e) {
    if (isPulling && window.scrollY === 0) {
      currentY = e.touches[0].clientY;
      pullDistance = currentY - startY;
      
      if (pullDistance > 0) {
        e.preventDefault();
        // Add visual feedback here if needed
        if (pullDistance > refreshThreshold) {
          // Change visual indicator to show ready to refresh
        }
      }
    }
  }, { passive: false });

  document.addEventListener('touchend', function(e) {
    if (isPulling && pullDistance > refreshThreshold) {
      // Trigger refresh
      if (document.getElementById('subTabs').style.display === 'block') {
        showLoading();
        fetch(matchesApi)
          .then(res => res.json())
          .then(data => {
            matches = data.matches || [];
            renderMatches(currentSubTab);
          })          .catch(e => {
            console.error('Refresh error:', e);
            document.getElementById('match-list').innerHTML = '<p style="text-align:center; color:#f00;">Failed to refresh data.</p>';
          });
      }
    }
    
    isPulling = false;
    pullDistance = 0;
  }, { passive: true });

  // Add error boundary for better error handling
  window.addEventListener('error', function(e) {
    console.error('Global error:', e.error);
  });

  window.addEventListener('unhandledrejection', function(e) {
    console.error('Unhandled promise rejection:', e.reason);
  });

  // Add performance monitoring
  if ('performance' in window) {
    window.addEventListener('load', function() {
      setTimeout(() => {
        const perfData = performance.getEntriesByType('navigation')[0];
        console.log('Page load time:', perfData.loadEventEnd - perfData.loadEventStart, 'ms');
      }, 0);
    });
  }

  // Add network status monitoring
  function updateNetworkStatus() {
    if ('navigator' in window && 'onLine' in navigator) {
      if (!navigator.onLine) {
        const offlineNotice = document.createElement('div');
        offlineNotice.id = 'offline-notice';
        offlineNotice.innerHTML = '📡 You are offline. Some features may not work.';
        offlineNotice.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          background: #ff6b35;
          color: white;
          text-align: center;
          padding: 10px;
          z-index: 9999;
          font-size: 14px;
          font-weight: 600;
        `;
        document.body.appendChild(offlineNotice);
      } else {
        const existingNotice = document.getElementById('offline-notice');
        if (existingNotice) {
          existingNotice.remove();
        }
      }
    }
  }

  window.addEventListener('online', updateNetworkStatus);
  window.addEventListener('offline', updateNetworkStatus);
  updateNetworkStatus(); // Check initial status

</script>  

</body>  
</html>
